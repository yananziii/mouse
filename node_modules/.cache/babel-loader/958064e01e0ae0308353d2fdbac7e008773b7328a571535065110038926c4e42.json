{"ast":null,"code":"import { getApproves, editApproves } from \"../../api/api.js\";\nimport { getToken } from \"../../utils/setToken.js\";\nexport default {\n  data() {\n    return {\n      approvaslList: [],\n      state: 3,\n      // 总条数\n      totalCount: 0,\n      // 默认显示第几页\n      currentPage: 1,\n      // 个数选择器\n      pageSizes: [5, 10],\n      // 默认每页显示的条数\n      PageSize: 5,\n      //控制驳回对话框的显示与隐藏\n      disallowVisible: false,\n      //驳回框表单\n      rejectForm: [],\n      //驳回原因\n      reject: \"\",\n      //审批状态筛选\n      StateList: [{\n        value: 3,\n        label: \"全部\"\n      }, {\n        value: 2,\n        label: \"待审批\"\n      }, {\n        value: 0,\n        label: \"已通过\"\n      }, {\n        value: 1,\n        label: \"未通过\"\n      }],\n      editForm: {\n        approver1: \"\",\n        state1: 0,\n        cause1: \"\",\n        appro_date1: \"\"\n      }\n    };\n  },\n  created() {\n    this.id = JSON.parse(getToken(\"work_num\"));\n    this.editForm.approver1 = this.id;\n    this.getList();\n  },\n  methods: {\n    getList() {\n      getApproves(this.id, this.currentPage, this.PageSize, this.state).then(res => {\n        if (res.data.ret == 0) {\n          this.approvaslList = res.data.data_list;\n          this.totalCount = res.data.total;\n        }\n      });\n    },\n    allowList(id, order_id, state1, state2) {\n      var date = new Date();\n      var year = date.getFullYear();\n      var dateArr = [date.getMonth() + 1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()];\n      var strDate = year + \"/\" + dateArr[0] + \"/\" + dateArr[1] + \" \" + dateArr[2] + \":\" + dateArr[3] + \":\" + dateArr[4];\n      this.editForm.appro_date1 = strDate;\n      if (state1 == 2 && state2 == 2) {\n        editApproves(id, order_id, this.editForm).then(res => {\n          if (res.data.ret == 0) {\n            this.$message.success(\"操作成功\");\n            this.getList();\n          }\n        });\n      } else {\n        this.$message.error(\"无法操作！\");\n      }\n    },\n    //展示驳回表单\n    showRejectList(work_num, order_id, state1, state2) {\n      this.disallowVisible = true;\n      this.rejectForm.work_num = work_num;\n      this.rejectForm.order_id = order_id;\n      this.rejectForm.state1 = state1;\n      this.rejectForm.state2 = state2;\n    },\n    disAllowList() {\n      var date = new Date();\n      var year = date.getFullYear();\n      var dateArr = [date.getMonth() + 1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()];\n      var strDate = year + \"/\" + dateArr[0] + \"/\" + dateArr[1] + \" \" + dateArr[2] + \":\" + dateArr[3] + \":\" + dateArr[4];\n      this.editForm.appro_date1 = strDate;\n      this.editForm.state1 = 1;\n      this.editForm.cause1 = this.reject;\n      if (this.rejectForm.state1 == 2 && this.rejectForm.state2 == 2 && this.reject != \"\") {\n        editApproves(this.rejectForm.work_num, this.rejectForm.order_id, this.editForm).then(res => {\n          if (res.data.ret == 0) {\n            this.$message.success(\"操作成功\");\n            //关闭对话框\n            this.disallowVisible = false;\n            this.getList();\n          } else {\n            this.$message.error(\"无法操作！\");\n          }\n        });\n      }\n    },\n    handleSizeChange(val) {\n      // 改变每页显示的条数\n      this.PageSize = val;\n      // 注意：在改变每页显示的条数时，要将页码显示到第一页\n      this.currentPage = 1;\n      // 点击每页显示的条数时，显示第一页\n      this.getList();\n    },\n    handleCurrentChange(val) {\n      // 改变默认的页数\n      this.currentPage = val;\n      // 切换页码时，要获取每页显示的条数\n      this.getList();\n    },\n    search() {\n      this.currentPage = 1;\n      this.getList();\n    }\n  }\n};","map":{"version":3,"names":["getApproves","editApproves","getToken","data","approvaslList","state","totalCount","currentPage","pageSizes","PageSize","disallowVisible","rejectForm","reject","StateList","value","label","editForm","approver1","state1","cause1","appro_date1","created","id","JSON","parse","getList","methods","then","res","ret","data_list","total","allowList","order_id","state2","date","Date","year","getFullYear","dateArr","getMonth","getDate","getHours","getMinutes","getSeconds","strDate","$message","success","error","showRejectList","work_num","disAllowList","handleSizeChange","val","handleCurrentChange","search"],"sources":["src/components/Expert/Approves.vue"],"sourcesContent":["<template>\n  <div>\n    <el-card>\n      <el-breadcrumb separator-class=\"el-icon-arrow-right\">\n        <el-breadcrumb-item :to=\"{ path: '/Notice' }\">首页</el-breadcrumb-item>\n        <el-breadcrumb-item>团队管理</el-breadcrumb-item>\n        <el-breadcrumb-item>流程审批</el-breadcrumb-item>\n      </el-breadcrumb>\n      <el-row :gutter=\"0\" class=\"apps-top\">\n        <el-col :span=\"24\" class=\"apps-top-des\"> 流程审批 </el-col>\n      </el-row>\n    </el-card>\n    <el-card>\n      <el-row :gutter=\"40\">\n        <el-col :span=\"18\" class=\"apps-data-des\"> 表单 </el-col>\n        <el-col :span=\"3\">\n          <el-select v-model=\"state\" size=\"mini\" placeholder=\"请选择状态\">\n            <el-option\n              label=\"全部\"\n              :value=\"3\"\n              @click.native=\"search\"\n            ></el-option>\n            <el-option\n              label=\"待审批\"\n              :value=\"2\"\n              @click.native=\"search\"\n            ></el-option>\n            <el-option\n              label=\"未通过\"\n              :value=\"1\"\n              @click.native=\"search\"\n            ></el-option>\n            <el-option\n              label=\"已通过\"\n              :value=\"0\"\n              @click.native=\"search\"\n            ></el-option>\n          </el-select>\n        </el-col>\n      </el-row>\n      <el-table :data=\"approvaslList\" stripe>\n        <el-table-column\n          label=\"工单id\"\n          prop=\"order_id\"\n          min-width=\"15%\"\n        ></el-table-column>\n        <el-table-column label=\"审批类型\" prop=\"category\" min-width=\"15%\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.category == 'work'\">员工信息</span>\n            <span v-if=\"scope.row.category == 'project'\">项目信息</span>\n            <span v-if=\"scope.row.category == 'person'\">个人信息</span>\n            <span v-if=\"scope.row.category == 'allow'\">权限开通</span>\n          </template></el-table-column\n        >\n        <el-table-column\n          label=\"项目名称/修改人姓名\"\n          prop=\"modify_name\"\n          min-width=\"15%\"\n        ></el-table-column>\n        <el-table-column label=\"修改字段\" prop=\"field_name\" min-width=\"15%\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.field_name == 'team_group'\">团队组别</span>\n            <span v-if=\"scope.row.field_name == 'work_role'\">员工类型</span>\n            <span v-if=\"scope.row.field_name == 'power'\">系统权限</span>\n            <span v-if=\"scope.row.field_name == 'delivery_time'\"\n              >期望交付时间</span\n            >\n            <span v-if=\"scope.row.field_name == 'submit_time'\">提报时间</span>\n            <span v-if=\"scope.row.field_name == 'data_amount'\">需求总量级</span>\n            <span v-if=\"scope.row.field_name == 'unit'\">数据单位</span>\n            <span v-if=\"scope.row.field_name == 'background'\">需求背景</span>\n            <span v-if=\"scope.row.field_name == 'regulation'\">标注规则</span>\n            <span v-if=\"scope.row.field_name == 'accuracy'\"\n              >期望交付准确率</span\n            >\n            <span v-if=\"scope.row.field_name == 'is_repeat'\"\n              >是否给予基于历史迭代需求</span\n            >\n            <span v-if=\"scope.row.field_name == 'tprice'\">单价</span>\n            <span v-if=\"scope.row.field_name == 'note'\">备注</span>\n            <span v-if=\"scope.row.field_name == 'project_manager'\"\n              >项目经理</span\n            >\n            <span v-if=\"scope.row.field_name == 'project_expert'\"\n              >质控专家</span\n            >\n          </template></el-table-column\n        >\n        <el-table-column\n          label=\"修改后结果\"\n          prop=\"field_result\"\n          min-width=\"15%\"\n        ></el-table-column>\n        <el-table-column\n          label=\"第一审批人审批状态\"\n          prop=\"state1\"\n          min-width=\"15%\"\n        >\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.state1 == 0\">已通过</span>\n            <span v-if=\"scope.row.state1 == 1\">未通过</span>\n            <span v-if=\"scope.row.state1 == 2\">待审批</span>\n          </template></el-table-column\n        >\n        <el-table-column\n          label=\"第二审批人审批状态\"\n          prop=\"state1\"\n          min-width=\"15%\"\n        >\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.state2 == 0\">已通过</span>\n            <span v-if=\"scope.row.state2 == 1\">未通过</span>\n            <span v-if=\"scope.row.state2 == 2\">待审批</span>\n          </template></el-table-column\n        >\n        <el-table-column label=\"审批\" min-width=\"10%\">\n          <template slot-scope=\"scope\">\n            <span>\n              <el-button\n                size=\"mini\"\n                @click=\"\n                  allowList(\n                    id,\n                    scope.row.order_id,\n                    scope.row.state1,\n                    scope.row.state2\n                  )\n                \"\n              >\n                通过</el-button\n              >\n            </span>\n            <span>\n              <el-button\n                size=\"mini\"\n                @click=\"\n                  showRejectList(\n                    id,\n                    scope.row.order_id,\n                    scope.row.state1,\n                    scope.row.state2\n                  )\n                \"\n              >\n                驳回</el-button\n              >\n            </span>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div>\n        <el-pagination\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n          :current-page=\"currentPage\"\n          :page-sizes=\"pageSizes\"\n          :page-size=\"PageSize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"totalCount\"\n        >\n        </el-pagination>\n      </div>\n    </el-card>\n    <!--   驳回审批对话框 -->\n    <el-dialog\n      title=\"驳回原因\"\n      :visible.sync=\"disallowVisible\"\n      width=\"50%\"\n      :close-on-click-modal=\"false\"\n    >\n      <!--   内容主体 -->\n      <el-input v-model=\"reject\"> </el-input>\n      <!--   底部区域-->\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"disallowVisible = false\">取 消</el-button>\n        <!--         <el-button  id= \"btn_sub\" type=\"primary\" @click=\"addList(); addButtonF()\" >确 定</el-button> -->\n        <el-button\n          id=\"btn_sub\"\n          type=\"primary\"\n          @click=\"disAllowList()\"\n          v-preventReClick\n          >确 定</el-button\n        >\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { getApproves, editApproves } from \"../../api/api.js\";\nimport { getToken } from \"../../utils/setToken.js\";\nexport default {\n  data() {\n    return {\n      approvaslList: [],\n      state: 3,\n      // 总条数\n      totalCount: 0,\n      // 默认显示第几页\n      currentPage: 1,\n      // 个数选择器\n      pageSizes: [5, 10],\n      // 默认每页显示的条数\n      PageSize: 5,\n      //控制驳回对话框的显示与隐藏\n      disallowVisible: false,\n      //驳回框表单\n      rejectForm: [],\n      //驳回原因\n      reject: \"\",\n      //审批状态筛选\n      StateList: [\n        {\n          value: 3,\n          label: \"全部\",\n        },\n        {\n          value: 2,\n          label: \"待审批\",\n        },\n        {\n          value: 0,\n          label: \"已通过\",\n        },\n        {\n          value: 1,\n          label: \"未通过\",\n        },\n      ],\n      editForm: {\n        approver1: \"\",\n        state1: 0,\n        cause1: \"\",\n        appro_date1: \"\",\n      },\n    };\n  },\n  created() {\n    this.id = JSON.parse(getToken(\"work_num\"));\n    this.editForm.approver1 = this.id;\n    this.getList();\n  },\n  methods: {\n    getList() {\n      getApproves(this.id, this.currentPage, this.PageSize, this.state).then(\n        (res) => {\n          if (res.data.ret == 0) {\n            this.approvaslList = res.data.data_list;\n            this.totalCount = res.data.total;\n          }\n        }\n      );\n    },\n    allowList(id, order_id, state1, state2) {\n      var date = new Date();\n      var year = date.getFullYear();\n      var dateArr = [\n        date.getMonth() + 1,\n        date.getDate(),\n        date.getHours(),\n        date.getMinutes(),\n        date.getSeconds(),\n      ];\n      var strDate =\n        year +\n        \"/\" +\n        dateArr[0] +\n        \"/\" +\n        dateArr[1] +\n        \" \" +\n        dateArr[2] +\n        \":\" +\n        dateArr[3] +\n        \":\" +\n        dateArr[4];\n      this.editForm.appro_date1 = strDate;\n      if (state1 == 2 && state2 == 2) {\n        editApproves(id, order_id, this.editForm).then((res) => {\n          if (res.data.ret == 0) {\n            this.$message.success(\"操作成功\");\n            this.getList();\n          }\n        });\n      } else {\n        this.$message.error(\"无法操作！\");\n      }\n    },\n    //展示驳回表单\n    showRejectList(work_num, order_id, state1, state2) {\n      this.disallowVisible = true;\n      this.rejectForm.work_num = work_num;\n      this.rejectForm.order_id = order_id;\n      this.rejectForm.state1 = state1;\n      this.rejectForm.state2 = state2;\n    },\n    disAllowList() {\n      var date = new Date();\n      var year = date.getFullYear();\n      var dateArr = [\n        date.getMonth() + 1,\n        date.getDate(),\n        date.getHours(),\n        date.getMinutes(),\n        date.getSeconds(),\n      ];\n      var strDate =\n        year +\n        \"/\" +\n        dateArr[0] +\n        \"/\" +\n        dateArr[1] +\n        \" \" +\n        dateArr[2] +\n        \":\" +\n        dateArr[3] +\n        \":\" +\n        dateArr[4];\n      this.editForm.appro_date1 = strDate;\n      this.editForm.state1 = 1;\n      this.editForm.cause1 = this.reject;\n      if (this.rejectForm.state1 == 2 && this.rejectForm.state2 == 2 && this.reject != \"\") {\n        editApproves(\n          this.rejectForm.work_num,\n          this.rejectForm.order_id,\n          this.editForm\n        ).then((res) => {\n          if (res.data.ret == 0) {\n            this.$message.success(\"操作成功\");\n            //关闭对话框\n            this.disallowVisible = false;\n            this.getList();\n          } else {\n            this.$message.error(\"无法操作！\");\n          }\n        });\n      }\n    },\n    handleSizeChange(val) {\n      // 改变每页显示的条数\n      this.PageSize = val;\n      // 注意：在改变每页显示的条数时，要将页码显示到第一页\n      this.currentPage = 1;\n      // 点击每页显示的条数时，显示第一页\n      this.getList();\n    },\n    handleCurrentChange(val) {\n      // 改变默认的页数\n      this.currentPage = val;\n      // 切换页码时，要获取每页显示的条数\n      this.getList();\n    },\n    search() {\n      this.currentPage = 1;\n      this.getList();\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.apps-top {\n  display: flex;\n  justify-content: space-around;\n}\n.apps-top-des {\n  font-size: 18px;\n  font-weight: 600;\n  padding-top: 10px;\n}\n.apps-top-add {\n  padding-bottom: 1px;\n}\n.apps-data-des {\n  font-size: 15px;\n  font-weight: 600;\n  padding-top: 8px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}